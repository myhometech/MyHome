<!DOCTYPE html>
<html>
<head>
    <title>Document Viewer Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Document Viewer Test</h1>
    <div id="results"></div>
    
    <button onclick="testDocumentViewer()">Test Document Viewer Opening</button>
    <button onclick="testModalState()">Test Modal State Management</button>
    <button onclick="testDocumentFetch()">Test Document Data Fetch</button>

    <script>
        async function testDocumentViewer() {
            const results = document.getElementById('results');
            
            try {
                // Test if we can simulate clicking a document card
                const testResult = document.createElement('div');
                testResult.className = 'test-result';
                testResult.innerHTML = '<strong>Document Viewer Test:</strong> Testing modal opening...';
                results.appendChild(testResult);
                
                // Simulate setting showModal state (this would normally happen in React)
                console.log('Simulating document click...');
                console.log('showModal state should change to true');
                console.log('DocumentPreview component should render');
                
                testResult.innerHTML += '<br>‚úÖ Modal state simulation successful';
                testResult.className += ' success';
                
            } catch (error) {
                const testResult = document.createElement('div');
                testResult.className = 'test-result error';
                testResult.innerHTML = `<strong>Error:</strong> ${error.message}`;
                results.appendChild(testResult);
            }
        }

        async function testModalState() {
            const results = document.getElementById('results');
            
            try {
                // Test modal state management
                const testResult = document.createElement('div');
                testResult.className = 'test-result';
                testResult.innerHTML = '<strong>Modal State Test:</strong> Testing state management...';
                results.appendChild(testResult);
                
                // Test various states that could cause hanging
                const states = [
                    { isLoading: true, error: null, pdfData: null },
                    { isLoading: false, error: 'Test error', pdfData: null },
                    { isLoading: false, error: null, pdfData: 'mock-data' }
                ];
                
                states.forEach((state, index) => {
                    console.log(`Testing state ${index + 1}:`, state);
                });
                
                testResult.innerHTML += '<br>‚úÖ All state combinations tested successfully';
                testResult.className += ' success';
                
            } catch (error) {
                const testResult = document.createElement('div');
                testResult.className = 'test-result error';
                testResult.innerHTML = `<strong>Error:</strong> ${error.message}`;
                results.appendChild(testResult);
            }
        }

        async function testDocumentFetch() {
            const results = document.getElementById('results');
            
            try {
                const testResult = document.createElement('div');
                testResult.className = 'test-result';
                testResult.innerHTML = '<strong>Document Fetch Test:</strong> Testing API endpoints...';
                results.appendChild(testResult);
                
                // Test document list fetch
                const response = await fetch('/api/documents', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const documents = await response.json();
                    testResult.innerHTML += `<br>‚úÖ Document list fetched: ${documents.length} documents found`;
                    
                    if (documents.length > 0) {
                        const firstDoc = documents[0];
                        testResult.innerHTML += `<br>üìÑ First document: ID ${firstDoc.id}, "${firstDoc.name}"`;
                        testResult.innerHTML += `<br>üìã MIME type: ${firstDoc.mimeType}`;
                        testResult.innerHTML += `<br>üìè File size: ${firstDoc.fileSize} bytes`;
                    }
                    
                    testResult.className += ' success';
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                const testResult = document.createElement('div');
                testResult.className = 'test-result error';
                testResult.innerHTML = `<strong>Error:</strong> ${error.message}`;
                results.appendChild(testResult);
            }
        }
    </script>
</body>
</html>